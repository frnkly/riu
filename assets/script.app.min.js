/**
 * Riu App
 *
 * @author Francis Amankrah <frank@frnk.ca>
 * @license http://www.gnu.org/licenses/gpl.html GNU General Public License
 */
var App={Result:{},Regex:{query:/^([0-9\.,\s]+(?:\.[0-9]+)?)[ ]?([a-z\-\*\/\^0-9]+)[ ]?(?:[a-z\-*\/\^\s]+ )?([a-z\-*\/\^0-9]+)$/i,queryFeet:/^([0-9]+)'\s?([0-9]+)?(?:"|'')?[ ]?(?:[a-z\-\/\^\s]+ )?([a-z\-]+)/i},init:function(){if($('input[name="q"]').val().length>0)this.go();else this.reset(true);this.message('Riu.')},go:function(i){var q=i||$('input[name="q"]').val();if(q.length<1)return this.abort('What do you want to convert?');this.guess();if(typeof this.Result=='object'){var a=this.Result.text+' <a href="#" onclick="App.box(\'#explanation-div\');">?</a>';$('#explanation').html(this.Result.explanation);if(this.Result.note){}this.message(a)}},guess:function(){var q=$('input[name="q"]').val();this.log('New query "'+q+'"');q=q.replace(/^\s+|^[a-z\s]+|\s+$|[^a-z0-9\.,*\u00B7\u00D7\/\-\^'"`\s]+/ig,'');q=q.replace(/\s+/g,' ');if(q.length<1)return this.abort('What do you want to convert?');if(q.indexOf('`')>-1)q=q.replace(/`/g,'\'');if(q.indexOf('..')>-1)q=q.replace(/\.+/g,'.');if(q.indexOf(' per ')>-1)q=q.replace(/\s+per\s+/ig,'/');if(q.indexOf('mph')>-1)q=q.replace(/mph/ig,'miles/hour');if(q.indexOf(' square')>-1)q=q.replace(/\s+squared?/ig,'^2 ');if(q.indexOf(' cube')>-1)q=q.replace(/(\s+cubed?)/ig,'^3 ');if(q.indexOf('·')>-1)q=q.replace(/\u00B7/g,'*');if(q.indexOf('×')>-1)q=q.replace(/\u00D7/g,'*');var a,fromUnit,toUnit;if(q.indexOf('\'')>-1){var m=q.match(this.Regex.queryFeet);m[2]=m[2]||0;a=parseInt(m[1],10)+parseFloat(m[2]/12,10);fromUnit='ft';toUnit=m[3]}else{var m=q.match(this.Regex.query);if(!m)return this.abort('What do you want to convert?');a=parseFloat(m[1].replace(/[,\s]+/g,''),10);fromUnit=m[2];toUnit=m[3]}this.Result=Units.convert(a,fromUnit,toUnit);if(typeof this.Result=='string')return this.abort(this.Result);if(this.Result.text.indexOf('*')>-1){this.Result.text=this.Result.text.replace(/\*/g,'&#183;');this.Result.explanation=this.Result.explanation.replace(/\*/g,' &#215; ')}return true},message:function(m){if(typeof m=='string')$('#r').html(m)},reset:function(a){this.message('Riu.');this.Result={};if(!a)$('input[name="q"]').val('').focus()},abort:function(a,b){if(!b)this.reset();if(typeof a=='string'&&a.length>0)this.message(a);return false},log:function(a){if(console)console.log('App.js - '+a)}};App.box=function(a){if(!$(a).is(':hidden'))return;$('.pop').hide();if($(a).is(':hidden')){$(a).slideDown(300)}else{$('.pop').hide()}};$(document).ready(function(){App.init();$('#tool').click(function(){App.box('#abt-tool')});$('#author').click(function(){App.box('#abt-author')});$('#offline').click(function(){App.box('#go-offline')});$('.pop').click(function(){$('.pop').hide()})});