/**
 * Riu App
 *
 * @author Francis Amankrah <frank@frnk.ca>
 * @license http://www.gnu.org/licenses/gpl.html GNU General Public License
 */
var App={result:{},init:function(){if($('input[name="q"]').val().length>0)this.go();else this.reset(true);this.message('Riu.')},go:function(i){var q=i||$('input[name="q"]').val();if(q.length<1)return this.abort('What do you want to convert?');this.guess();if(typeof this.result=='object'){var a=this.result.text;if(this.result.explanation){a+=' <a href="#" onclick="App.box(\'#explanation-div\');">?</a>';$('#explanation').html(this.result.explanation)}if(this.result.note){}this.message(a)}},guess:function(){var q=$('input[name="q"]').val();this.log('New query "'+q+'"');q=q.replace(/^\s+|^[a-z\s]+|\s+$|[^a-z0-9\.,*\u00B7\u00D7\/\-\^'"`\s]+/ig,'');q=q.replace(/\s+/g,' ');if(q.length<1)return this.abort('What do you want to convert?');if(q.indexOf('`')>-1)q=q.replace(/`/g,'\'');if(q.indexOf('..')>-1)q=q.replace(/\.+/g,'.');if(q.indexOf(' per ')>-1)q=q.replace(/\s+per\s+/ig,'/');if(q.indexOf('mph')>-1)q=q.replace(/mph/ig,'miles/hour');if(q.indexOf('·')>-1)q=q.replace(/\u00B7/g,'*');if(q.indexOf('×')>-1)q=q.replace(/\u00D7/g,'*');var v,u1,u2;if(q.indexOf('\'')>-1){var m=q.match(/^([0-9]+)'\s?([0-9]+)?(?:"|'')?[ ]?(?:[a-z\-\/\^\s]+ )?([a-z\-]+)/i);m[2]=m[2]||0;v=parseInt(m[1],10)+parseFloat(m[2]/12,10);u1='ft';u2=m[3]}else{var m=q.match(/^([0-9\.,\s]+(?:\.[0-9]+)?)[ ]?([a-z\-\*\/\^]+)[ ]?(?:[a-z\-*\/\^\s]+ )?([a-z\-*\/\^]+)$/i);if(!m)return this.abort('What do you want to convert?');v=parseFloat(m[1].replace(/[,\s]+/g,''),10);u1=m[2];u2=m[3]}this.result=Units.convert(v,u1,u2);if(typeof this.result=='string')return this.abort(this.result);if(this.result.text.indexOf('*')>-1){this.result.text=this.result.text.replace(/\*/g,'&#183;');this.result.explanation=this.result.explanation.replace(/\*/g,' &#215; ')}return true},message:function(m){if(typeof m=='string')$('#r').html(m)},reset:function(a){this.message('Riu.');this.result={};if(!a)$('input[name="q"]').val('').focus()},abort:function(a,b){this.result={};if(!b)this.reset();if(typeof a=='string'&&a.length>0)this.message(a);return false},log:function(a){if(console)console.log('Riu/App: '+a)}};App.box=function(a){if(!$(a).is(':hidden'))return;$('.pop').hide();if($(a).is(':hidden')){$(a).slideDown(300)}else{$('.pop').hide()}};$(document).ready(function(){App.init();$('#tool').click(function(){App.box('#abt-tool')});$('#author').click(function(){App.box('#abt-author')});$('#offline').click(function(){App.box('#go-offline')});$('.pop').click(function(){$('.pop').hide()})});